<!DOCTYPE html>
<html lang="en_US">
<head>
    <meta charset="utf-8" />
    <title>Our first pygame part 7 | Game Experiments</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta name="author" content="Richard Porteous">
    <meta name="description" content="Various coding tutorials">
    <meta name="keywords" content="blog, site, tutorials, coding, software, programming">

    
    <link href="https://richard-porteous.github.io/css/bootswatch/lux.min.css" rel="stylesheet">
    
    <link href="https://richard-porteous.github.io/css/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://richard-porteous.github.io/css/custom.css" rel="stylesheet">

<link rel="icon" type="image/x-icon" href="https://richard-porteous.github.io/favicon.ico" />



<script type="text/javascript">
    var azbalacSettingHeaderMoveTitle = 'false';
</script>
<script src="https://richard-porteous.github.io/js/jquery-3.4.1.min.js"></script>
<script src="https://richard-porteous.github.io/js/functions.js"></script><style>body {}.footer-container { background-color: #29281f; }.footer-container { color: #f9fcf9; }</style>



<link id="typography-header-title-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Exo%3A800"><style id="typography-title" type="text/css">#site-header-text a {
        font-family: Exo;
    }#site-header-text a {
        font-size: 50px; 
    }</style>

<link id="typography-header-subtitle-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Exo%3A600"><style id="typography-subtitle" type="text/css">#site-description {
        font-family: Exo;
    }#site-description {
        font-size: 30px; 
    }</style>

<style id="typography-body" type="text/css"></style>

<style id="typography-navbar" type="text/css">nav#navbarMain {
        font-size: 20px; 
    }
    nav#navbarMain ul.dropdown-menu {
        font-size: 20px;
    }</style>

<link id="typography-headline-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"><style id="typography-headline" type="text/css">h1, h2, h3, h4, h5, h6 {
                font-family: Open Sans; 
            }</style>



    
    <script type="text/javascript">
        var azbalacSettingHeaderColor = { 'bg': '#000000',
            'transp': '0'
            };

    </script>
    <style type="text/css">
        #site-header-text a, #site-description {
                background: "#000000";  
            background:  rgba(0,0,0,0.00);
            
        }
    </style>
    
    
    <style type="text/css">
        #site-header-box-title {
            margin-bottom: 0px;
        }
    </style>
    
    
    <style type="text/css">
        #site-header-container-overlay {
        
            left: 20px;
        
        
            top: 20px;
        
        }
    </style>
    


<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
        <script src="//cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="//cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


</head>


<body>

<div id="header" role="banner" style="">

    <div class="container">
        <header class="masthead">
            <div>
                <div id="site-header-container-above" class="row align-items-center">
                    
                </div>
            </div>


            

            <div id="site-header-above"><a href="https://richard-porteous.github.io/" rel="home">
                <picture>
                        <source media="(min-width: 1200px)" srcset="https://richard-porteous.github.io/img/header_background.jpg 1110w">
                        <source media="(min-width: 992px) and (max-width: 1199.98px)" srcset="https://richard-porteous.github.io/img/header_background.jpg 930w">
                        <source media="(min-width: 768px) and (max-width: 991.98px)" srcset="https://richard-porteous.github.io/img/header_background.jpg 690w">
                        <source media="(min-width: 576px) and (max-width: 767.98px)" srcset="https://richard-porteous.github.io/img/header_background.jpg 510w">
                        <source media="(max-width: 575.98px)" srcset="https://richard-porteous.github.io/img/header_background.jpg 476w">
                        <img id="site-header-image" src="https://richard-porteous.github.io/img/header_background.jpg" style="max-width: 100%; width: 100%">
                </picture>
                </a>

                <div id="site-header-container-overlay" class="position-absolute  fixed-top ">
                    <div id="site-header-box-title" class=" d-flex justify-content-start ">
                        <h1 class="azbalac-title" id="site-header-text"><a class="header-url" style="color: #FFFFFF;" href="https://richard-porteous.github.io/">Game Experiments</a></h1>
                    </div>
                    
                    <div id="site-header-box-subtitle" class=" d-flex justify-content-start ">   
                        <h2 class="azbalac-subtitle" id="site-description" style="color: #EEEEFF;">Learn with me</h2>
                    </div>
                </div>
                
             
            </div>

    
    <nav id="navbarMain" class="navbar navbar-expand-sm justify-content-between mb-3 navbar-dark bg-primary" role="navigation">
        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
        </button>
      
            
            <div class="sticky-top navbar-collapse collapse  " id="navbarSupportedContent"> 
                <ul class="navbar-nav">

  
  <li class="nav-item ">
    <a class="nav-link" href="/">
      
      Home
    </a>
  </li>
  <span class="mx-2"></span>
  

  
  <li class="nav-item ">
    <a class="nav-link" href="/posts/">
      
      Blog
    </a>
  </li>
  <span class="mx-2"></span>
  

  
  <li class="nav-item ">
    <a class="nav-link" href="/about/">
      
      About
    </a>
  </li>
  <span class="mx-2"></span>
  
</ul>
             
            </div>
        
            
    </nav> 
    



      </header>
    </div> 
</div>


    <div id="main">
        <div class="container">
            <div class="row"><div class="col-md" id="content">





<h1>Our first pygame part 7</h1>

    <div class="post-meta"><span class="byline-icon fa fa-clock-o" aria-hidden="true"></span> <span class="screen-reader-text">Date: </span><time datetime="2024-01-19T11:40:22-07:00">19.01.2024</time> - 
    <span class="byline-icon fa fa-user" aria-hidden="true"></span><span class="screen-reader-text">Author: </span> Richard Porteous
     </div>


  <h2 id="what-we-have-so-far">What we have so far</h2>
<p>
<img src="/img/blog/pygame/my-app/tail_left_behind.png" alt=""  /></p>
<p>We have a head with a face that can eat food but leaves droppings at each place it has eaten at. Lets address that.</p>
<p>What do we want to do?</p>
<ul>
<li>make the tail follow the head</li>
<li>tail can be added at head or at last tail piece (changes logic and appearance of the game only very slightly)</li>
<li>reuse the code from the player for the tail wherever possible</li>
<li>prevent messy code</li>
<li>fix the class names to be consitant with the standard i.e. classes use Pascal case</li>
</ul>
<p>The 3rd and 4th points imply I should be using a class or classes to support our player and its tail. There will be some common code which we could name GameObject, and some head specific code like getting its direction and biting.
The head and tail work together so Player will manipulate both. We will not yet use a sprite yet but will handle the textures in our GameObject which could use sprites later.</p>
<h2 id="create-a-player-class">Create a Player Class</h2>
<p>We start by grabbing all the current player code and placing it into a class. And all the tail code and placing that into a Tail class</p>
<p>i.e.</p>
<pre tabindex="0"><code>#player
player = pygame.image.load(&#34;assets/player/blue_body_squircle.png&#34;)
player_face = pygame.image.load(&#34;assets/player/face_a.png&#34;)
player = pygame.transform.scale_by(player, 0.5 )
player_face = pygame.transform.scale_by(player_face, 0.5 )
player_rect = player.get_rect()
player_face_rect = player_face.get_rect()
player_rect.center = TILESIZE[0]/2, TILESIZE[1]/2
player_face_rect.center = player_rect.center
player_tail = []
</code></pre><p>and</p>
<pre tabindex="0"><code>player_body = pygame.image.load(&#34;assets/player/blue_body_circle.png&#34;)
player_body = pygame.transform.scale_by(player_body, 0.5 )
</code></pre><p>and</p>
<pre tabindex="0"><code>direction = (0,0)
from_tile = player_rect.center
player_current_speed = PLAYERNORMALSPEED
</code></pre><p>etc &hellip;</p>
<p>Notice in the code below I do rename bit of code - to track what I did you could look for similar code or git differences for that commit.</p>
<p>Here are the two classes after moving the code</p>
<pre tabindex="0"><code>class Player():
    start_move_pos = (0,0)
    end_move_pos = (0,0)
    direction = (0,0)
    def __init__(self, speed):
        self.image = pygame.image.load(&#34;assets/player/blue_body_squircle.png&#34;)
        self.image = pygame.transform.scale_by(self.image, 0.5 )
        self.rect = self.image.get_rect()
        self.rect.center = TILESIZE[0]/2, TILESIZE[1]/2

        self.face_image = pygame.image.load(&#34;assets/player/face_a.png&#34;)
        self.face_image = pygame.transform.scale_by(self.face_image, 0.5 )

        self.face_rect = self.face_image.get_rect()
        self.face_rect.center = self.rect.center
        self.start_move_pos = self.rect.center
        self.speed = speed

    def setup_next_move(self, direction):
        self.direction = direction
        self.rect.center = self.end_move_pos
        self.start_move_pos = self.end_move_pos

    def is_end_of_move(self, dt_distance):
        return abs(math.dist(self.rect.center, self.end_move_pos)) &lt;= abs(dt_distance)
    
    def keep_moving(self, dt_distance):
        velocity = (self.direction[0] * dt_distance, self.direction[1] * dt_distance)
        self.rect = self.rect.move(velocity)

    def move(self, dt_distance, new_direction, def_direction, continuous):
        direction = self.direction
        if direction != (0,0) or new_direction != (0,0):
            if (self.is_end_of_move(dt_distance)):
                if (continuous and new_direction == (0,0)):
                    direction = def_direction
                else:
                    direction = new_direction
                self.setup_next_move(direction)
            else:
                #keep moving we are not there yet
                self.keep_moving(dt_distance)



class Tail():
    def __init__(self):
        self.image = pygame.image.load(&#34;assets/player/blue_body_circle.png&#34;)
        self.image = pygame.transform.scale_by(self.image, 0.5 )
        self.rect = self.image.get_rect()
        #self.rect.center = TILESIZE[0]/2, TILESIZE[1]/2
</code></pre><p>Besides renamining the obvious I could use better names in each object.</p>
<p>Later I use pygames sprites for some inspiration as I want function names to be similar and do similar things to keep understanding of the library simple.</p>
<blockquote>
<p>Python functions in an object also know as methods that refer to self need to accept self as the first parameter.</p>
</blockquote>
<p>Ok so we also need to fix the assings and use functions. Here is the final listing. I can&rsquo;t say it often enough &hellip; LOOK AT THE GIT and check out the differences. If you are unfamiliar with git on the terminal or don&rsquo;t want another thing to learn use a gui that has a decent amount of functionality.</p>
<p>
<img src="/img/blog/pygame/my-app/git-diff-on-my-app-repo.png" alt=""  /></p>
<h2 id="how-code-looks-when-done">How code looks when done</h2>
<pre tabindex="0"><code>import math
import random
import pygame
from pygame.locals import *


SCALESIZE = 0.5
TILE_SIZE = (80,80)
TILESIZE = (TILE_SIZE[0] * SCALESIZE, TILE_SIZE[1] * SCALESIZE)


PLAYERNORMALSPEED = 0.4 * SCALESIZE

# set window size
size = width, height = (800, 560)
screen = pygame.display.set_mode(size)

black = (0,0,0)
white = (255,255,255)
#screen.fill(white)

#background
background = pygame.Surface.copy(screen)
background.fill(white)

for y in range(0, height, int(TILESIZE[0])):
    pygame.draw.line(background, black, (0,y), (width,y))
for x in range(0, width, int(TILESIZE[1])):
    pygame.draw.line(background, black, (x,0), (x,height))

# use this to optimize images // may need to adjust background color as it assumes black
def load_image(file):
    img = pygame.image.load(file)
    img = img.convert()
    img = img.convert_alpha()
    return img


class Player():
    start_move_pos = (0,0)
    end_move_pos = (0,0)
    direction = (0,0)
    def __init__(self, speed):
        self.image = pygame.image.load(&#34;assets/player/blue_body_squircle.png&#34;)
        self.image = pygame.transform.scale_by(self.image, 0.5 )
        self.rect = self.image.get_rect()
        self.rect.center = TILESIZE[0]/2, TILESIZE[1]/2

        self.face_image = pygame.image.load(&#34;assets/player/face_a.png&#34;)
        self.face_image = pygame.transform.scale_by(self.face_image, 0.5 )

        self.face_rect = self.face_image.get_rect()
        self.face_rect.center = self.rect.center
        self.start_move_pos = self.rect.center
        self.speed = speed

    def setup_next_move(self, direction):
        self.direction = direction
        self.rect.center = self.end_move_pos
        self.start_move_pos = self.end_move_pos

    def is_end_of_move(self, dt_distance):
        return abs(math.dist(self.rect.center, self.end_move_pos)) &lt;= abs(dt_distance)
    
    def keep_moving(self, dt_distance):
        velocity = (self.direction[0] * dt_distance, self.direction[1] * dt_distance)
        self.rect = self.rect.move(velocity)

    def move(self, dt_distance, new_direction, def_direction, continuous):
        direction = self.direction
        if direction != (0,0) or new_direction != (0,0):
            if (self.is_end_of_move(dt_distance)):
                if (continuous and new_direction == (0,0)):
                    direction = def_direction
                else:
                    direction = new_direction
                self.setup_next_move(direction)
            else:
                #keep moving we are not there yet
                self.keep_moving(dt_distance)



class Tail():
    def __init__(self):
        self.image = pygame.image.load(&#34;assets/player/blue_body_circle.png&#34;)
        self.image = pygame.transform.scale_by(self.image, 0.5 )
        self.rect = self.image.get_rect()
        #self.rect.center = TILESIZE[0]/2, TILESIZE[1]/2




player = Player(PLAYERNORMALSPEED)
player_body = Tail()
player_tail = []

#food
food = pygame.image.load(&#34;assets/food/tile_coin.png&#34;)
food = pygame.transform.scale_by(food, 0.5 )
food_rect = food.get_rect()
food_rect.center = (TILESIZE[0] * 9 + TILESIZE[0]/2) , (TILESIZE[1] * 9 + TILESIZE[1]/2)

screen.blit(background,(0,0))

# update the display to see what we set
pygame.display.update()

# Initialize the pygame code
pygame.init()
# Max frame rate
clock = pygame.time.Clock()
FPS = 60

#speed = 10
# control variable
game_running = True

# time based movement requires delta time
class DeltaTime():
    def __init__(self):
        self.last_loop = pygame.time.get_ticks()
        self.dt = 0


    def loop_time(self) -&gt; int:
        time_now_ms = pygame.time.get_ticks()
        dt = time_now_ms - self.last_loop
        self.last_loop = time_now_ms
        return dt
    

class KeyInput():

    def __init__(self) -&gt; None:
        self.key_queue = []
        self.last_key_pressed = &#34;none&#34;

    def getEvents(self):
       
        for event in pygame.event.get():
            if event.type == QUIT or (event.type==pygame.KEYDOWN and event.key in [K_ESCAPE]):
                self.key_queue.clear()
                return False
            
            # KEEP KEY PRESS ORDER
            if event.type==pygame.KEYDOWN:
                if event.key == K_ESCAPE:
                    return False
                if event.key in [K_s, K_DOWN]:
                    self.last_key_pressed = &#34;D&#34;
                    self.key_queue.append(&#34;D&#34;)
                if event.key in [K_w, K_UP]:
                    self.last_key_pressed = &#34;U&#34;
                    self.key_queue.append(&#34;U&#34;)
                if event.key in [K_d, K_RIGHT]:
                    self.last_key_pressed = &#34;R&#34;
                    self.key_queue.append(&#34;R&#34;)
                if event.key in [K_a, K_LEFT]:
                    self.last_key_pressed = &#34;L&#34;
                    self.key_queue.append(&#34;L&#34;)

            # KEEP KEY PRESS ORDER (remove released from middle too)
            if event.type==pygame.KEYUP:
                if event.key in [K_s, K_DOWN]:
                    self.key_queue.remove(&#34;D&#34;)
                if event.key in [K_w, K_UP]:
                    self.key_queue.remove(&#34;U&#34;)
                if event.key in [K_d, K_RIGHT]:
                    self.key_queue.remove(&#34;R&#34;)
                if event.key in [K_a, K_LEFT]:
                    self.key_queue.remove(&#34;L&#34;)
        #if(self.upkey or self.rightkey or self.downkey or self.leftkey):
        #    print(&#34;up&#34;,self.upkey, &#34;right&#34;, self.rightkey, &#34;down&#34;, self.downkey, &#34;left&#34;, self.leftkey)
        return True
    
    def get_first_of_remaining_pressed(self):
        keys = pygame.key.get_pressed()

        while(len(self.key_queue) &gt; 0):
            match (self.key_queue[0]): 
                case &#34;U&#34;:
                    if keys[pygame.K_UP] or keys[pygame.K_w]:
                        return (0,-1)
                case &#34;D&#34;:
                    if keys[pygame.K_DOWN] or keys[pygame.K_s]:
                        return (0,1)
                case &#34;L&#34;:
                    if keys[pygame.K_LEFT] or keys[pygame.K_a]:
                        return (-1,0)
                case &#34;R&#34;:
                    if keys[pygame.K_RIGHT] or keys[pygame.K_d]:
                        return (1,0)
            
            #in-valid front of queue items are removed
            self.key_queue.pop(0)

        return(0,0)

    def get_last_direction_chosen(self):
        match (self.last_key_pressed):
            case &#34;U&#34;:
                return (0,-1)
            case &#34;D&#34;:
                return (0,1)
            case &#34;L&#34;:
                return (-1,0)
            case &#34;R&#34;:
                return (1,0)
        return (0,0)

    def clean_queue(self):
        self.key_queue = []
        

#initialize the classes
held_keys = KeyInput()
delta_time = DeltaTime()

continuous = True
keypress_for_partialtime = False

#game loop
while game_running:
    clock.tick(FPS)

    # indicating the number of miliseconds since the last time that piece of code was run
    dt = delta_time.loop_time()
    
    dt_distance = player.speed * dt

    game_running = held_keys.getEvents()

    player.end_move_pos = (player.start_move_pos[0] + player.direction[0] * TILESIZE[0], player.start_move_pos[1] + player.direction[1] * TILESIZE[1])
    
    direction = player.direction
    new_direction = held_keys.get_first_of_remaining_pressed()
    def_direction = held_keys.get_last_direction_chosen()
 
    # do we have a direction?
    player.move(dt_distance,new_direction,def_direction,continuous)

    if (player.rect.center == food_rect.center):
        x = random.randrange(0, 20)
        y = random.randrange(0, 14)
        food_rect.center = (TILESIZE[0] * x + TILESIZE[0]/2) , (TILESIZE[1] * y + TILESIZE[1]/2)
        player_tail.append(player.rect)
        

    #clear the display
    screen.blit(background,(0,0))

    # place image on the screen
    screen.blit(food, food_rect)
    
    for t in player_tail:
        if t != player.rect:
            screen.blit(player_body.image,t)
    
    screen.blit(player.image, player.rect)
    player.face_rect.center = player.rect.center
    screen.blit(player.face_image, player.face_rect)

    # apply changes
    pygame.display.update()


# quit the pygame window
pygame.quit()
#the app exits
</code></pre><h2 id="still-a-lot-of-work-to-do">Still a lot of work to do</h2>
<p>first we will split out code we think will be common to all our game objects.
We will leave everything that is specific to the head or tail there. If it repeated code its a candidate to move to the shared code.</p>
<p>So We grab the first bit of the Player class and create our GameObject class.
Every moving gameobject will have a start, end and direction</p>
<pre tabindex="0"><code>class GameObject():
    start_move_pos = (0,0)
    end_move_pos = (0,0)
    direction = (0,0)
</code></pre><p>file names are specific to head or tail but the code to load and scale isn&rsquo;t</p>
<pre tabindex="0"><code>    def __init__(self, speed, tilesize, img_file):
        self.image = pygame.image.load(img_file)
        self.image = pygame.transform.scale_by(self.image, 0.5 )
        self.rect = self.image.get_rect()
</code></pre><p>and</p>
<pre tabindex="0"><code>        self.rect.center = tilesize[0]/2, tilesize[1]/2
        self.start_move_pos = self.rect.center
        self.speed = speed
</code></pre><p>and the player will use it like the following</p>
<pre tabindex="0"><code>class Player(GameObject):
    def __init__(self, speed, tilesize):
        super().__init__(speed, tilesize, &#34;assets/player/blue_body_squircle.png&#34;)

        self.face_image = pygame.image.load(&#34;assets/player/face_a.png&#34;)
        self.face_image = pygame.transform.scale_by(self.face_image, 0.5 )
        self.face_rect = self.face_image.get_rect()
        self.face_rect.center = self.rect.center
</code></pre><p>and tail like the following</p>
<pre tabindex="0"><code>class Tail(GameObject):
    def __init__(self, speed, tilesize):
        super().__init__(speed, tilesize, &#34;assets/player/blue_body_circle.png&#34;)
</code></pre><p>below the classes we initialize them</p>
<pre tabindex="0"><code>player = Player(PLAYERNORMALSPEED, TILESIZE)
player_body = Tail(PLAYERNORMALSPEED, TILESIZE)
player_tail = []
</code></pre><p>OK next post we focus on getting the tail to follow. first we try a simple method then we see how to reimplement in the classes.</p>
<p><a href="/posts/python/our_first_pygame_6/">Prev Post</a> - <a href="/posts/">Next Post</a></p>


                </div></div>
        </div>
    </div>

    
        <div class="footer-container" style="">
    <div class="container">
        <footer>

            <div class="row">
            
            
                
                    <div class="col">
    <!-- raw HTML omitted -->
<!-- raw HTML omitted -->

</div>
                
                    <div class="col">
    
</div>
                
                    <div class="col">
    
</div>
                
            

            </div>
        </footer>
    </div>
</div>
    
    
        
<div class="subfooter-container">

    <div class="container">
        <div class="footer">
            <div class="row wrapper padding">
                <div class="col-xs-12 col-md-12">

            
            
                
                        <p>Powered by <a href="https://gohugo.io">Hugo</a>. Theme <a href="https://github.com/geschke/hugo-tikva">Tikva</a> by <a href="https://www.kuerbis.org">Ralf Geschke</a>.</p>


                
            
                  
                </div>
            </div>
        </div>
    </div>
</div>

    

    <div id="media-width-detection-element"></div>

<script src="https://richard-porteous.github.io/js/popper.min.js"></script>
<script src="https://richard-porteous.github.io/js/bootstrap.min.js"></script>


</body>
</html>